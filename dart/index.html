<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Smart Popup Dictionary</title>

<style>
/* Popup box */
#dictPopup {
    position: absolute;
    padding: 12px;
    border-radius: 10px;
    background: #1e1e1e;
    color: white;
    max-width: 280px;
    font-size: 14px;
    line-height: 1.4;
    display: none;
    z-index: 999999;
    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    backdrop-filter: blur(6px);
}

/* Word title */
#dictPopup b {
    font-size: 16px;
    display: block;
    margin-bottom: 6px;
}

/* Section heading */
.dict-label {
    color: #00eaff;
    margin-top: 6px;
    font-size: 12px;
    font-weight: bold;
}

/* Speaker icon */
.speak-btn {
    cursor: pointer;
    margin-left: 6px;
    font-size: 16px;
}
</style>
</head>

<body style="font-family: Arial; padding: 40px;">

<h2>Select any word to see meaning</h2>
<p>
    This is a demonstration article. You can click any English word and get the Bangla meaning instantly.
    The translation is automatic, fast and supports synonyms, examples, and pronunciation.
</p>

<!-- Popup -->
<div id="dictPopup"></div>

<script>
// Free APIs
const TRANSLATE_API = "https://api.mymemory.translated.net/get?q=";
const DICT_API = "https://api.dictionaryapi.dev/api/v2/entries/en/";

// Convert English â†’ Bangla
async function translateToBangla(text) {
    let res = await fetch(TRANSLATE_API + text + "&langpair=en|bn");
    let data = await res.json();
    return data.responseData.translatedText || "";
}

// Dictionary (synonyms, example, meaning)
async function getDictionary(word) {
    try {
        let res = await fetch(DICT_API + word.toLowerCase());
        let data = await res.json();
        return data[0];
    } catch {
        return null;
    }
}

// Pronounce audio
function playAudio(url) {
    let a = new Audio(url);
    a.play().catch(()=>{});
}

// Main function
async function showPopup(word, x, y) {
    const popup = document.getElementById("dictPopup");
    popup.innerHTML = "Loading...";

    popup.style.left = x + 10 + "px";
    popup.style.top = y + 10 + "px";
    popup.style.display = "block";

    let bn = await translateToBangla(word);
    let dict = await getDictionary(word);

    let meaning = "";
    let example = "";
    let synonymList = "";
    let audioURL = "";

    if (dict && dict.meanings) {
        // English meaning
        meaning = dict.meanings[0]?.definitions[0]?.definition || "";

        // Example
        example = dict.meanings[0]?.definitions[0]?.example || "";

        // Synonyms
        synonymList = dict.meanings[0]?.synonyms?.slice(0, 5).join(", ") || "";

        // Audio
        audioURL = dict.phonetics?.find(p => p.audio)?.audio || "";
    }

    popup.innerHTML = `
        <b>${word} 
            ${audioURL ? `<span class='speak-btn' onclick="playAudio('${audioURL}')">ðŸ”Š</span>` : ""}
        </b>

        <div class="dict-label">Bangla Meaning</div>
        ${bn || "Not found"}

        ${meaning ? `
            <div class="dict-label">English Meaning</div>
            ${meaning}
        ` : ""}

        ${synonymList ? `
            <div class="dict-label">Synonyms</div>
            ${synonymList}
        ` : ""}

        ${example ? `
            <div class="dict-label">Example</div>
            "${example}"
        ` : ""}
    `;
}

// Text selection
function getSelectedWord(e) {
    let text = window.getSelection().toString().trim();

    // Word only, no sentence
    if (text.split(" ").length === 1 && /^[a-zA-Z]+$/.test(text)) {
        showPopup(text, e.pageX, e.pageY);
    } else {
        document.getElementById("dictPopup").style.display = "none";
    }
}

document.addEventListener("mouseup", getSelectedWord);

// Mobile long-press
let pressTimer;
document.addEventListener("touchstart", function(e) {
    pressTimer = setTimeout(() => {
        let sel = window.getSelection().toString().trim();
        if (sel) getSelectedWord(e.touches[0]);
    }, 400);
});
document.addEventListener("touchend", () => clearTimeout(pressTimer));

</script>

</body>
</html>
