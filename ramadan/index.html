<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ramadan Serenity</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome for Islamic Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f5f7fa;
            color: #2c3e50;
            transition: all 0.3s ease;
        }
        .dark-mode {
            background-color: #1a2530;
            color: #d4d9e0;
        }
        header {
            background: linear-gradient(135deg, #27ae60, #219653);
            padding: 25px;
            border-radius: 15px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        .dark-mode header {
            background: linear-gradient(135deg, #2e3b4e, #1a2530);
        }
        header .animation {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        .moon, .star {
            position: absolute;
            color: rgba(255, 255, 255, 0.3);
            animation: moveAcross 15s linear infinite;
        }
        .moon { font-size: 2rem; }
        .star { font-size: 1rem; }
        @keyframes moveAcross {
            0% { transform: translateX(-100px); }
            100% { transform: translateX(calc(100% + 100px)); }
        }
        .container {
            max-width: 1200px;
            padding: 20px;
        }
        .card {
            margin-bottom: 20px;
            transition: transform 0.3s ease, opacity 0.5s ease;
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            background-color: #fff;
            overflow: hidden;
        }
        .dark-mode .card {
            background-color: #2e3b4e;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        .card:hover {
            transform: scale(1.03);
        }
        .card-header {
            background: #2ecc71;
            color: white;
            cursor: pointer;
            padding: 15px;
            border-radius: 10px 10px 0 0;
        }
        .dark-mode .card-header {
            background: #34495e;
        }
        .card-body {
            padding: 20px;
        }
        .btn {
            transition: transform 0.2s ease, background-color 0.3s ease;
            border-radius: 8px;
        }
        .btn:active {
            transform: scale(0.95);
        }
        .btn-primary {
            background-color: #27ae60;
            border-color: #27ae60;
        }
        .btn-primary:hover {
            background-color: #219653;
            border-color: #219653;
        }
        .sehri-iftar {
            font-weight: bold;
            color: #e74c3c;
        }
        #preloader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }
        .spinner {
            font-size: 3rem;
            animation: spin 1s linear infinite, pulse 1.5s infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        footer {
            text-align: center;
            padding: 20px;
            font-size: 0.9rem;
            color: #7f8c8d;
        }
        .dark-mode footer {
            color: #a1b1c1;
        }
        .countdown {
            font-size: 1.5rem;
            color: #2980b9;
            font-weight: 500;
            transition: color 0.3s ease;
        }
        .dark-mode .countdown {
            color: #3498db;
        }
        @media (max-width: 768px) {
            .card {
                margin-bottom: 15px;
            }
            .card-header {
                padding: 10px;
            }
            .card-body {
                padding: 15px;
            }
            .countdown {
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>
    <!-- Preloader -->
    <div id="preloader">
        <i class="fas fa-moon spinner"></i>
    </div>

    <header class="text-center mb-4">
        <div class="animation">
            <i class="fas fa-moon moon" style="top: 20%; left: 10%; animation-delay: 0s;"></i>
            <i class="fas fa-star star" style="top: 40%; left: 30%; animation-delay: 2s;"></i>
            <i class="fas fa-star star" style="top: 60%; left: 50%; animation-delay: 4s;"></i>
            <i class="fas fa-moon moon" style="top: 80%; left: 70%; animation-delay: 6s;"></i>
        </div>
        <h1><i class="fas fa-mosque"></i> <span class="lang" data-bn="রমজান শান্তি" data-en="Ramadan Serenity">রমজান শান্তি</span></h1>
        <div class="d-flex justify-content-center gap-3">
            <button id="darkModeToggle" class="btn btn-outline-light">Toggle Dark Mode</button>
            <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" id="langToggle" checked>
                <label class="form-check-label text-white" for="langToggle">Bangla / English</label>
            </div>
            <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" id="prayerAlerts" checked>
                <label class="form-check-label text-white" for="prayerAlerts">Prayer Alerts</label>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Clock and Dates -->
        <div class="card">
            <div class="card-header" data-bs-toggle="collapse" data-bs-target="#clockCollapse">
                <h3><i class="fas fa-clock"></i> <span class="lang" data-bn="ঘড়ি ও তারিখ" data-en="Clock & Dates">ঘড়ি ও তারিখ</span></h3>
            </div>
            <div id="clockCollapse" class="card-body collapse show">
                <h2 id="clock">Initializing...</h2>
                <p id="gregorianDate">Gregorian: Initializing...</p>
                <p id="banglaDate">Bangla: Initializing...</p>
                <p id="hijriDate">Hijri: Initializing...</p>
            </div>
        </div>

        <!-- District Selection and Countdown -->
        <div class="card">
            <div class="card-header" data-bs-toggle="collapse" data-bs-target="#districtCollapse">
                <h3><i class="fas fa-map-marker-alt"></i> <span class="lang" data-bn="জেলা ও কাউন্টডাউন" data-en="District & Countdown">জেলা ও কাউন্টডাউন</span></h3>
            </div>
            <div id="districtCollapse" class="card-body collapse show">
                <label for="districtSelect" class="lang" data-bn="জেলা নির্বাচন করুন:" data-en="Select District:">জেলা নির্বাচন করুন:</label>
                <select id="districtSelect" class="form-select mb-3">
                    <option value="dhaka" selected>Dhaka</option>
                    <option value="chattogram">Chattogram</option>
                    <option value="rajshahi">Rajshahi</option>
                    <option value="khulna">Khulna</option>
                    <option value="barishal">Barishal</option>
                    <option value="sylhet">Sylhet</option>
                    <option value="rangpur">Rangpur</option>
                    <option value="mymensingh">Mymensingh</option>
                </select>
                <p class="countdown" id="prayerCountdown">Countdown to next event: Calculating...</p>
            </div>
        </div>

        <!-- Today's Prayer Times -->
        <div class="card">
            <div class="card-header" data-bs-toggle="collapse" data-bs-target="#todayCollapse">
                <h3><i class="fas fa-pray"></i> <span class="lang" data-bn="আজকের নামাজের সময়" data-en="Today's Prayer Times">আজকের নামাজের সময়</span></h3>
            </div>
            <div id="todayCollapse" class="card-body collapse show">
                <div id="todayPrayerTimes">Fetching prayer times...</div>
            </div>
        </div>

        <!-- 30-Day Ramadan Schedule -->
        <div class="card">
            <div class="card-header" data-bs-toggle="collapse" data-bs-target="#scheduleCollapse">
                <h3><i class="fas fa-calendar-alt"></i> <span class="lang" data-bn="৩০ দিনের রমজান তালিকা" data-en="30-Day Ramadan Schedule">৩০ দিনের রমজান তালিকা</span></h3>
            </div>
            <div id="scheduleCollapse" class="card-body collapse show">
                <label for="ramadanStart" class="lang" data-bn="রমজান শুরুর তারিখ নির্বাচন করুন:" data-en="Select Ramadan Start Date:">রমজান শুরুর তারিখ নির্বাচন করুন:</label>
                <input type="date" id="ramadanStart" class="form-control mb-2" value="2025-03-01">
                <button id="generateSchedule" class="btn btn-primary lang" data-bn="তালিকা তৈরি করুন" data-en="Generate Schedule">তালিকা তৈরি করুন</button>
                <button id="downloadPdf" class="btn btn-secondary mt-2 lang" data-bn="পিডিএফ ডাউনলোড" data-en="Download PDF" style="display: none;">পিডিএফ ডাউনলোড</button>
                <div id="ramadanSchedule" class="mt-3"></div>
            </div>
        </div>

        <!-- Specific Date Lookup -->
        <div class="card">
            <div class="card-header" data-bs-toggle="collapse" data-bs-target="#lookupCollapse">
                <h3><i class="fas fa-search"></i> <span class="lang" data-bn="নির্দিষ্ট তারিখ অনুসন্ধান" data-en="Specific Date Lookup">নির্দিষ্ট তারিখ অনুসন্ধান</span></h3>
            </div>
            <div id="lookupCollapse" class="card-body collapse show">
                <input type="date" id="specificDate" class="form-control mb-2">
                <button id="lookupDate" class="btn btn-primary lang" data-bn="অনুসন্ধান" data-en="Lookup">অনুসন্ধান</button>
                <div id="specificDateResult" class="mt-3">Select a date to see prayer times</div>
            </div>
        </div>

        <!-- Islamic Tips -->
        <div class="card">
            <div class="card-header" data-bs-toggle="collapse" data-bs-target="#tipsCollapse">
                <h3><i class="fas fa-lightbulb"></i> <span class="lang" data-bn="ইসলামিক পরামর্শ" data-en="Islamic Tips">ইসলামিক পরামর্শ</span></h3>
            </div>
            <div id="tipsCollapse" class="card-body collapse show">
                <div id="islamicTips">Loading tips...</div>
            </div>
        </div>

        <!-- Islamic Quotes -->
        <div class="card">
            <div class="card-header" data-bs-toggle="collapse" data-bs-target="#quotesCollapse">
                <h3><i class="fas fa-quote-left"></i> <span class="lang" data-bn="ইসলামিক উক্তি" data-en="Islamic Quote">ইসলামিক উক্তি</span></h3>
            </div>
            <div id="quotesCollapse" class="card-body collapse show">
                <div id="islamicQuote">Loading quote...</div>
            </div>
        </div>
    </div>

    <footer>Developed by Dr. Afif Bashar</footer>

    <!-- Audio for Notifications -->
    <audio id="prayerSound" preload="auto">
        <source src="https://www.islamcan.com/audio/adhan/azan1.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
    <script src="https://unpkg.com/jspdf@latest/dist/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/jspdf-autotable@latest/dist/jspdf.plugin.autotable.min.js"></script>
    <script>
        // Preloader
        window.addEventListener('load', () => {
            setTimeout(() => {
                const preloader = document.getElementById('preloader');
                preloader.style.opacity = '0';
                setTimeout(() => preloader.style.display = 'none', 500);
            }, 2000);
        });

        // District Data
        const districtData = {
            dhaka: { lat: 23.7104, lon: 90.4074 },
            chattogram: { lat: 22.3569, lon: 91.7832 },
            rajshahi: { lat: 24.3636, lon: 88.6241 },
            khulna: { lat: 22.8456, lon: 89.5403 },
            barishal: { lat: 22.7010, lon: 90.3535 },
            sylhet: { lat: 24.8949, lon: 91.8687 },
            rangpur: { lat: 25.7439, lon: 89.2752 },
            mymensingh: { lat: 24.7471, lon: 90.4203 }
        };

        // Bangla Months
        const banglaMonths = ["বৈশাখ", "জ্যৈষ্ঠ", "আষাঢ়", "শ্রাবণ", "ভাদ্র", "আশ্বিন", "কার্তিক", "অগ্রহায়ণ", "পৌষ", "মাঘ", "ফাল্গুন", "চৈত্র"];

        // Language Toggle
        let isBangla = true;
        function updateLanguage() {
            document.querySelectorAll('.lang').forEach(el => {
                el.textContent = isBangla ? el.dataset.bn : el.dataset.en;
            });
            loadTodayPrayerTimes();
        }
        document.getElementById('langToggle').addEventListener('change', () => {
            isBangla = !isBangla;
            updateLanguage();
        });
        updateLanguage();

        // Clock
        function updateClock() {
            const date = new Date();
            let hours = date.getHours();
            let minutes = date.getMinutes();
            let seconds = date.getSeconds();
            let ampm = hours >= 12 ? 'PM' : 'AM';
            hours = hours % 12 || 12;
            minutes = minutes < 10 ? '0' + minutes : minutes;
            seconds = seconds < 10 ? '0' + seconds : seconds;
            document.getElementById('clock').textContent = `${hours}:${minutes}:${seconds} ${ampm}`;
            document.getElementById('gregorianDate').textContent = `${isBangla ? 'গ্রেগরিয়ান:' : 'Gregorian:'} ${date.toLocaleDateString('en-US', { dateStyle: 'long' })}`;
            const day = date.getDate();
            const monthIndex = date.getMonth();
            const year = date.getFullYear() - 593;
            document.getElementById('banglaDate').textContent = `${isBangla ? 'বাংলা:' : 'Bangla:'} ${day} ${banglaMonths[monthIndex]}, ${year} BS`;
            document.getElementById('hijriDate').textContent = `${isBangla ? 'হিজরি:' : 'Hijri:'} ${date.toLocaleDateString('en-US', { dateStyle: 'long', calendar: 'islamic-umalqura' })}`;
        }
        setInterval(updateClock, 1000);
        updateClock();

        // Dark Mode
        document.getElementById('darkModeToggle').addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
        });

        // Fetch Prayer Times with Retry Logic
        async function fetchPrayerTimes(date, district) {
            const coords = districtData[district];
            const url = `https://api.aladhan.com/v1/timings/${date}?latitude=${coords.lat}&longitude=${coords.lon}&method=2&school=1`;
            for (let attempt = 1; attempt <= 3; attempt++) {
                try {
                    const response = await fetch(url);
                    if (!response.ok) throw new Error(`API error: ${response.status}`);
                    const data = await response.json();
                    if (data.code === 200 && data.data.timings) {
                        console.log(`Fetched timings for ${date}:`, data.data.timings); // Debug log
                        return data.data.timings;
                    }
                    throw new Error('Invalid API response');
                } catch (error) {
                    console.error(`Attempt ${attempt} failed: ${error.message}`);
                    if (attempt === 3) {
                        console.error('All attempts failed.');
                        return null;
                    }
                    await new Promise(resolve => setTimeout(resolve, 1000)); // Wait 1s before retry
                }
            }
        }

        // Prayer Times Labels
        function updatePrayerTimesLabels(timings) {
            if (!timings) return null;
            return {
                sehri: isBangla ? `সেহরি (ইমসাক): ${timings.Imsak}` : `Sehri (Imsak): ${timings.Imsak}`,
                fajr: isBangla ? `ফজর: ${timings.Fajr}` : `Fajr: ${timings.Fajr}`,
                dhuhr: isBangla ? `যোহর: ${timings.Dhuhr}` : `Dhuhr: ${timings.Dhuhr}`,
                asr: isBangla ? `আসর: ${timings.Asr}` : `Asr: ${timings.Asr}`,
                iftar: isBangla ? `ইফতার (মাগরিব): ${timings.Maghrib}` : `Iftar (Maghrib): ${timings.Maghrib}`,
                isha: isBangla ? `ইশা: ${timings.Isha}` : `Isha: ${timings.Isha}`
            };
        }

        // Today's Prayer Times and Smart Countdown
        let todayTimings = null;
        let lastFetchDate = null;
        async function loadTodayPrayerTimes() {
            const district = document.getElementById('districtSelect').value;
            const today = new Date().toISOString().split('T')[0].replace(/-/g, '');
            const todayStr = new Date().toISOString().split('T')[0];

            if (!lastFetchDate || lastFetchDate !== todayStr || !todayTimings) {
                todayTimings = await fetchPrayerTimes(today, district);
                lastFetchDate = todayStr;
            }

            const labels = updatePrayerTimesLabels(todayTimings);
            const prayerTimesDiv = document.getElementById('todayPrayerTimes');
            prayerTimesDiv.style.opacity = '0';
            if (labels) {
                prayerTimesDiv.innerHTML = `
                    <span class="sehri-iftar">${labels.sehri}</span><br>
                    ${labels.fajr}<br>
                    ${labels.dhuhr}<br>
                    ${labels.asr}<br>
                    <span class="sehri-iftar">${labels.iftar}</span><br>
                    ${labels.isha}
                `;
            } else {
                prayerTimesDiv.textContent = isBangla ? 'নামাজের সময় আনতে ব্যর্থ। দয়া করে ইন্টারনেট সংযোগ চেক করুন।' : 'Failed to fetch prayer times. Please check your internet connection.';
            }
            prayerTimesDiv.style.opacity = '1';
            updateCountdown();
        }
        loadTodayPrayerTimes();
        document.getElementById('districtSelect').addEventListener('change', loadTodayPrayerTimes);

        // Smart Countdown with Notifications
        function updateCountdown() {
            const countdownDiv = document.getElementById('prayerCountdown');
            const audio = document.getElementById('prayerSound');
            if (!todayTimings) {
                countdownDiv.textContent = isBangla ? 'কাউন্টডাউন ডেটা পাওয়া যায়নি।' : 'Countdown data unavailable.';
                return;
            }

            const now = new Date();
            const todayStr = now.toISOString().split('T')[0];
            const times = [
                { name: isBangla ? 'সেহরি' : 'Sehri', time: todayTimings.Imsak },
                { name: isBangla ? 'ফজর' : 'Fajr', time: todayTimings.Fajr },
                { name: isBangla ? 'যোহর' : 'Dhuhr', time: todayTimings.Dhuhr },
                { name: isBangla ? 'আসর' : 'Asr', time: todayTimings.Asr },
                { name: isBangla ? 'ইফতার' : 'Iftar', time: todayTimings.Maghrib },
                { name: isBangla ? 'ইশা' : 'Isha', time: todayTimings.Isha }
            ];

            let nextEvent = null;
            for (const event of times) {
                if (!event.time) continue;
                const [hours, minutes] = event.time.split(':');
                const eventTime = new Date(`${todayStr}T${hours}:${minutes}:00`);
                eventTime.setSeconds(0);
                if (eventTime > now) {
                    nextEvent = { name: event.name, time: eventTime };
                    break;
                }
            }

            if (!nextEvent) {
                countdownDiv.textContent = isBangla ? 'আজকের সব ইভেন্ট শেষ।' : 'All events for today are done.';
                if (new Date().toISOString().split('T')[0] !== lastFetchDate) {
                    loadTodayPrayerTimes();
                }
                return;
            }

            const diff = nextEvent.time - now;
            times.forEach(event => {
                if (!event.time) return;
                const [hours, minutes] = event.time.split(':');
                const eventTime = new Date(`${todayStr}T${hours}:${minutes}:00`);
                eventTime.setSeconds(0);
                const eventDiff = eventTime - now;
                if (eventDiff >= 0 && eventDiff <= 60000 && !window.alertShown) {
                    audio.play().catch(err => console.error('Audio play failed:', err));
                    alert(`${isBangla ? `${event.name} সময় এসে গেছে!` : `${event.name} time has arrived!`}`);
                    window.alertShown = true;
                    setTimeout(() => window.alertShown = false, 60000);
                }
            });

            const hours = Math.floor(diff / 3600000);
            const minutes = Math.floor((diff % 3600000) / 60000);
            const seconds = Math.floor((diff % 60000) / 1000);
            countdownDiv.textContent = `${isBangla ? 'পরবর্তী ইভেন্ট পর্যন্ত:' : 'Countdown to next event:'} ${nextEvent.name} in ${hours}h ${minutes}m ${seconds}s`;
        }
        setInterval(() => {
            updateCountdown();
            const now = new Date().toISOString().split('T')[0];
            if (now !== lastFetchDate) loadTodayPrayerTimes();
        }, 1000);

        // 30-Day Ramadan Schedule
        document.getElementById('generateSchedule').addEventListener('click', async () => {
            const district = document.getElementById('districtSelect').value;
            const startDate = new Date(document.getElementById('ramadanStart').value);
            const scheduleDiv = document.getElementById('ramadanSchedule');
            scheduleDiv.style.opacity = '0';
            scheduleDiv.innerHTML = `<table class="table"><thead><tr><th>${isBangla ? 'তারিখ' : 'Date'}</th><th>${isBangla ? 'সেহরি' : 'Sehri'}</th><th>${isBangla ? 'ফজর' : 'Fajr'}</th><th>${isBangla ? 'যোহর' : 'Dhuhr'}</th><th>${isBangla ? 'আসর' : 'Asr'}</th><th>${isBangla ? 'ইফতার' : 'Iftar'}</th><th>${isBangla ? 'ইশা' : 'Isha'}</th></tr></thead><tbody></tbody></table>`;
            const tbody = scheduleDiv.querySelector('tbody');

            for (let i = 0; i < 30; i++) {
                const currentDate = new Date(startDate);
                currentDate.setDate(startDate.getDate() + i);
                const dateStr = currentDate.toISOString().split('T')[0].replace(/-/g, '');
                const timings = await fetchPrayerTimes(dateStr, district);
                if (timings) {
                    tbody.innerHTML += `
                        <tr>
                            <td>${currentDate.toLocaleDateString()}</td>
                            <td class="sehri-iftar">${timings.Imsak}</td>
                            <td>${timings.Fajr}</td>
                            <td>${timings.Dhuhr}</td>
                            <td>${timings.Asr}</td>
                            <td class="sehri-iftar">${timings.Maghrib}</td>
                            <td>${timings.Isha}</td>
                        </tr>
                    `;
                } else {
                    tbody.innerHTML += `<tr><td>${currentDate.toLocaleDateString()}</td><td colspan="6">${isBangla ? 'ডেটা পাওয়া যায়নি' : 'Data unavailable'}</td></tr>`;
                }
            }
            scheduleDiv.style.opacity = '1';
            document.getElementById('downloadPdf').style.display = 'block';
        });

        // Specific Date Lookup
        document.getElementById('lookupDate').addEventListener('click', async () => {
            const district = document.getElementById('districtSelect').value;
            const date = document.getElementById('specificDate').value.replace(/-/g, '');
            const resultDiv = document.getElementById('specificDateResult');
            resultDiv.style.opacity = '0';
            const timings = await fetchPrayerTimes(date, district);
            const labels = updatePrayerTimesLabels(timings);
            if (labels) {
                resultDiv.innerHTML = `
                    <span class="sehri-iftar">${labels.sehri}</span><br>
                    ${labels.fajr}<br>
                    ${labels.dhuhr}<br>
                    ${labels.asr}<br>
                    <span class="sehri-iftar">${labels.iftar}</span><br>
                    ${labels.isha}
                `;
            } else {
                resultDiv.textContent = isBangla ? 'নামাজের সময় আনতে ব্যর্থ।' : 'Unable to fetch prayer times.';
            }
            resultDiv.style.opacity = '1';
        });

        // Islamic Tips
        const tipsBn = [
            "সেহরিতে স্বাস্থ্যকর খাবার দিয়ে দিন শুরু করুন।",
            "রোজার সময় পানি পান করুন।",
            "সময়মতো নামাজ আদায় করুন।",
            "রমজানে অন্যদের সাথে দয়া ভাগ করুন।",
            "ইফতারের জন্য কৃতজ্ঞতার সাথে প্রস্তুতি নিন।"
        ];
        const tipsEn = [
            "Start your day with a healthy Sehri meal.",
            "Stay hydrated during non-fasting hours.",
            "Perform your prayers on time.",
            "Share kindness during Ramadan.",
            "Prepare for Iftar with gratitude."
        ];
        let tipIndex = 0;
        function rotateTips() {
            document.getElementById('islamicTips').textContent = isBangla ? tipsBn[tipIndex] : tipsEn[tipIndex];
            tipIndex = (tipIndex + 1) % tipsBn.length;
        }
        setInterval(rotateTips, 15000);
        rotateTips();

        // Islamic Quotes
        const quotesBn = [
            "নিশ্চয়ই প্রত্যেক কষ্টের সাথে স্বস্তি আছে। - কুরআন ৯৪:৬",
            "তোমাদের মধ্যে সর্বোত্তম তারা যার চরিত্র ও আচরণ সবচেয়ে ভালো। - নবী মুহাম্মদ (সা.)",
            "আল্লাহ কাউকে তার সাধ্যের বাইরে ভার দেন না। - কুরআন ২:২৮৬"
        ];
        const quotesEn = [
            "Verily, with every difficulty, there is relief. - Quran 94:6",
            "The best among you are those who have the best manners and character. - Prophet Muhammad (PBUH)",
            "Allah does not burden a soul beyond that it can bear. - Quran 2:286"
        ];
        let quoteIndex = 0;
        async function fetchQuote() {
            try {
                const response = await fetch('https://iffa-quotes-api.herokuapp.com/quotes/random');
                if (!response.ok) throw new Error('API failed');
                const data = await response.json();
                document.getElementById('islamicQuote').textContent = data.quote;
            } catch (error) {
                document.getElementById('islamicQuote').textContent = isBangla ? quotesBn[quoteIndex] : quotesEn[quoteIndex];
                quoteIndex = (quoteIndex + 1) % quotesBn.length;
            }
        }
        fetchQuote();
        setInterval(fetchQuote, 30000);

        // PDF Download
        document.getElementById('downloadPdf').addEventListener('click', () => {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const table = document.querySelector('#ramadanSchedule table');
            const district = document.getElementById('districtSelect').value;
            const startDate = document.getElementById('ramadanStart').value;
            if (table) {
                doc.setFontSize(16);
                doc.text(`${isBangla ? 'রমজান নামাজের তালিকা' : 'Ramadan Prayer Schedule'} - ${district} (${startDate})`, 14, 20);
                doc.autoTable({
                    html: table,
                    startY: 30,
                    theme: 'grid',
                    headStyles: { fillColor: [41, 128, 185] },
                    styles: { fontSize: 10 }
                });
                doc.save('ramadan_schedule.pdf');
            } else {
                alert(isBangla ? 'দয়া করে প্রথমে তালিকা তৈরি করুন।' : 'Please generate the schedule first.');
            }
        });
    </script>
</body>
</html>
