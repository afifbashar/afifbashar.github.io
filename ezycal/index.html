<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pediatric Dose Calculator</title>
    
    <!-- Bootstrap Dark Theme -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-dark-5@1.1.3/dist/dark.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --bg-color: #121212;
            --surface-color: #1e1e1e;
            --primary-color: #28a745;
            --text-primary: #e0e0e0;
            --text-secondary: #9e9e9e;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-primary);
            min-height: 100vh;
        }

        .calculator-card {
            background-color: var(--surface-color);
            border: 1px solid #2d2d2d;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            max-width: 800px;
            margin: 2rem auto;
        }

        .form-control, .form-select {
            background-color: #2d2d2d;
            border-color: #404040;
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        #searchResults {
            background-color: #2d2d2d;
            border: 1px solid #404040;
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
        }

        .list-group-item {
            background-color: #2d2d2d;
            border-color: #404040;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .result-card {
            background-color: #2d2d2d;
            border-left: 4px solid var(--primary-color);
            color: var(--text-primary);
        }

        .loading-spinner {
            color: var(--primary-color);
        }
    </style>
</head>
<body class="d-flex align-items-center">
    <div class="container py-5">
        <div class="calculator-card card">
            <div class="card-header bg-dark">
                <h3 class="mb-0 text-success">
                    <i class="fas fa-calculator me-2"></i>Pediatric Dose Calculator
                </h3>
            </div>
            
            <div class="card-body">
                <form id="doseCalculator">
                    <!-- Input Fields -->
                    <div class="row g-3 mb-4">
                        <div class="col-md-6">
                            <label class="form-label">Weight (kg)</label>
                            <input type="number" class="form-control" id="weight" step="0.1" min="0" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Age (days)</label>
                            <input type="number" class="form-control" id="ageDays" min="0">
                        </div>
                    </div>

                    <!-- Search & Selection -->
                    <div class="mb-4 position-relative">
                        <label class="form-label">Search Medication</label>
                        <div class="input-group">
                            <input type="text" class="form-control" id="drugSearch" placeholder="Search...">
                            <span class="input-group-text bg-dark border-dark">
                                <i class="fas fa-search text-success"></i>
                            </span>
                        </div>
                        <div id="searchResults" class="list-group mt-1 position-absolute w-100 d-none"></div>
                    </div>

                    <div class="row g-3 mb-4">
                        <div class="col-md-6">
                            <label class="form-label">Medication</label>
                            <select class="form-select" id="medication" required>
                                <option value="">Select medication</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Form</label>
                            <select class="form-select" id="medicationForm" required disabled>
                                <option value="">Select form</option>
                            </select>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-success btn-lg w-100">
                        <i class="fas fa-calculator me-2"></i>Calculate Dose
                    </button>
                </form>

                <div id="result" class="mt-4"></div>
            </div>
        </div>
    </div>

    <div class="loading-spinner spinner-border" role="status" style="display: none;">
        <span class="visually-hidden">Loading...</span>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        const drugDatabase = {
            // Antibiotics
            ampicillin: {
                name: 'Ampicillin',
                tradeNames: ['Ampexin', 'Acmeicillin', 'Ficillin'],
                category: 'Antibiotic',
                forms: {
                    vial: { strength: '250mg/2.5ml', dosePerKg: 33.3, concentration: '100mg/ml' },
                    syrup: { strength: '125mg/5ml', dosePerKg: 33.3, concentration: '25mg/ml' }
                },
                weightBased: true,
                maxDosePerDay: 3,
                interval: '8',
                notes: 'Neonates: 12 hourly dosing'
            },

            gentamicin: {
                name: 'Gentamicin',
                tradeNames: ['Gentin', 'Genacyn', 'Invigen'],
                category: 'Antibiotic',
                forms: {
                    vial: { strength: '20mg/2ml', dosePerKg: 1.67, concentration: '10mg/ml' }
                },
                weightBased: true,
                maxDosePerDay: 3,
                interval: '8',
                notes: 'Once daily dosing for neonates'
            },

            ceftriaxone: {
                name: 'Ceftriaxone',
                tradeNames: ['Ceftron', 'Dicephin', 'Roficin'],
                category: 'Antibiotic',
                forms: {
                    vial: { strength: '1g/10ml', dosePerKg: 50, concentration: '100mg/ml' }
                },
                weightBased: true,
                maxDosePerDay: 2,
                interval: '12',
                notes: 'Meningitis dose: 100mg/kg/day'
            },

            // ... Add all other drugs from the PDF following the same pattern ...

            paracetamol: {
                name: 'Paracetamol',
                tradeNames: ['Ace', 'Napa', 'Renova'],
                category: 'Analgesic',
                forms: {
                    syrup: { strength: '120mg/5ml', dosePerKg: 15, concentration: '24mg/ml' },
                    tablet: { strength: '500mg', dosePerKg: 15 }
                },
                weightBased: true,
                maxDosePerDay: 4,
                interval: '4-6',
                notes: 'Max 4g/day in adults'
            },

            salbutamol: {
                name: 'Salbutamol',
                tradeNames: ['Ventolin', 'Sultolin', 'Asthalin'],
                category: 'Bronchodilator',
                forms: {
                    syrup: {
                        strength: '2mg/5ml',
                        standardDose: {
                            '<2years': '2.5ml',
                            '2-5years': '5ml',
                            '>5years': '10ml'
                        }
                    }
                },
                weightBased: false,
                maxDosePerDay: 4,
                interval: '6-8'
            }
        };

        // Search Implementation
        document.getElementById('drugSearch').addEventListener('input', function(e) {
            const results = document.getElementById('searchResults');
            results.innerHTML = '';
            
            if(this.value.length > 1) {
                const searchTerm = this.value.toLowerCase();
                const matches = Object.entries(drugDatabase).filter(([key, drug]) => 
                    drug.name.toLowerCase().includes(searchTerm) ||
                    drug.tradeNames.some(t => t.toLowerCase().includes(searchTerm))
                );

                results.classList.toggle('d-none', matches.length === 0);
                
                matches.forEach(([key, drug]) => {
                    const item = document.createElement('a');
                    item.className = 'list-group-item';
                    item.innerHTML = `
                        <div class="d-flex justify-content-between">
                            <div>
                                <strong>${drug.name}</strong>
                                <div class="text-muted small">${drug.tradeNames.join(', ')}</div>
                            </div>
                            <span class="badge bg-secondary">${drug.category}</span>
                        </div>
                    `;
                    
                    item.addEventListener('click', (e) => {
                        e.preventDefault();
                        document.getElementById('medication').value = key;
                        document.getElementById('medication').dispatchEvent(new Event('change'));
                        this.value = '';
                        results.classList.add('d-none');
                    });
                    
                    results.appendChild(item);
                });
            } else {
                results.classList.add('d-none');
            }
        });

        // Form Handling
        document.getElementById('medication').addEventListener('change', function(e) {
            const formSelect = document.getElementById('medicationForm');
            formSelect.innerHTML = '<option value="">Select form</option>';
            
            if(this.value && drugDatabase[this.value]) {
                Object.entries(drugDatabase[this.value].forms).forEach(([form, details]) => {
                    const option = document.createElement('option');
                    option.value = form;
                    option.textContent = `${form.charAt(0).toUpperCase() + form.slice(1)} (${details.strength})`;
                    formSelect.appendChild(option);
                });
                formSelect.disabled = false;
            } else {
                formSelect.disabled = true;
            }
        });

        // Dose Calculation
        document.getElementById('doseCalculator').addEventListener('submit', function(e) {
            e.preventDefault();
            const weight = parseFloat(document.getElementById('weight').value);
            const medication = document.getElementById('medication').value;
            const form = document.getElementById('medicationForm').value;
            
            if(!weight || !medication || !form) return;
            
            const drug = drugDatabase[medication];
            const formData = drug.forms[form];
            let resultHTML = '';

            if(drug.weightBased) {
                const doseMg = (weight * formData.dosePerKg).toFixed(1);
                let administration = '';
                
                if(formData.concentration) {
                    const ml = (doseMg / formData.concentration.split('mg')[0]).toFixed(1);
                    administration = `${ml}ml`;
                    
                    if(form === 'syrup') {
                        const tsp = (ml / 5).toFixed(1);
                        administration += ` (${tsp} tsp)`;
                    }
                }
                
                resultHTML = `
                    <div class="result-card p-3">
                        <h5>${drug.name} Dosing</h5>
                        <p>Single Dose: <strong>${doseMg}mg</strong></p>
                        ${administration ? `<p>Administration: ${administration}</p>` : ''}
                        <p>Frequency: Every ${drug.interval} hours</p>
                        ${drug.notes ? `<div class="alert alert-warning mt-2">${drug.notes}</div>` : ''}
                    </div>
                `;
            } else {
                const age = parseInt(document.getElementById('ageDays').value) || 0;
                let ageGroup = Object.keys(formData.standardDose).find(range => {
                    const [min, max] = range.replace(/\D/g, ' ').split(' ').map(Number);
                    return age >= min && age <= max;
                });
                
                resultHTML = `
                    <div class="result-card p-3">
                        <h5>${drug.name} Dosing</h5>
                        <p>Standard Dose: <strong>${formData.standardDose[ageGroup]}</strong></p>
                        <p>Frequency: Every ${drug.interval} hours</p>
                    </div>
                `;
            }
            
            document.getElementById('result').innerHTML = resultHTML;
        });

        // Initialize Medications
        function initialize() {
            const select = document.getElementById('medication');
            Object.entries(drugDatabase).forEach(([key, drug]) => {
                const option = new Option(`${drug.name} (${drug.tradeNames[0]})`, key);
                select.add(option);
            });
        }

        initialize();
    </script>
</body>
</html>
